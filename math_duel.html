<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Duel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
        }

        .game-container {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 1000px;
            width: 100%;
            border: 4px solid #667eea;
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: clamp(2em, 6vw, 3em);
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: clamp(0.9em, 2.5vw, 1.1em);
        }

        .setup-panel {
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            padding: 12px;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(0.85em, 2vw, 1em);
            transition: all 0.3s;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .rounds-selector {
            text-align: center;
            margin-bottom: 20px;
        }

        .rounds-selector label {
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
            font-size: clamp(0.9em, 2vw, 1.1em);
        }

        .rounds-selector select {
            padding: 8px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: clamp(0.9em, 2vw, 1em);
            font-weight: bold;
        }

        .players-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-panel {
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .player1-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 4px solid #667eea;
        }

        .player2-panel {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: 4px solid #f093fb;
        }

        .player-header {
            color: white;
            font-size: clamp(1.5em, 4vw, 2em);
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .score-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 15px;
        }

        .score-label {
            font-size: clamp(0.8em, 2vw, 0.9em);
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
        }

        .score-value {
            font-size: clamp(2em, 5vw, 3em);
            font-weight: bold;
            color: #333;
        }

        .question-display {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-text {
            font-size: clamp(1.8em, 4vw, 2.5em);
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: clamp(1.3em, 3vw, 1.8em);
            text-align: center;
            border: 3px solid white;
            border-radius: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.95);
        }

        .answer-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            transform: scale(1.05);
        }

        .player1-panel .answer-input {
            border-color: #667eea;
        }

        .player2-panel .answer-input {
            border-color: #f093fb;
        }

        .answer-input.correct {
            animation: correctPulse 0.5s;
        }

        .answer-input.incorrect {
            animation: incorrectShake 0.5s;
        }

        .submit-answer-btn {
            width: 100%;
            padding: 12px;
            font-size: clamp(1em, 2.5vw, 1.3em);
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .player1-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .player2-submit {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
        }

        .submit-answer-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .submit-answer-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .submit-answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); background: #d1fae5; }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .round-indicator {
            text-align: center;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            font-size: clamp(1.2em, 3vw, 1.5em);
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            flex: 1;
            min-width: 140px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px;
            font-size: clamp(1em, 2.5vw, 1.2em);
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .timer-bar-container {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            transition: width 0.1s linear;
            border-radius: 6px;
        }

        .winner-banner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 1000;
            max-width: 90%;
            border: 5px solid #fbbf24;
        }

        .winner-banner.show {
            display: block;
            animation: popIn 0.5s;
        }

        @keyframes popIn {
            from {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .winner-banner h2 {
            font-size: clamp(2em, 6vw, 3.5em);
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .winner-stats {
            font-size: clamp(1.1em, 3vw, 1.4em);
            margin: 20px 0;
            line-height: 2;
            color: #333;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15vw;
            font-weight: bold;
            color: white;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            animation: countdownPulse 1s;
        }

        @keyframes countdownPulse {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .streak-indicator {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: clamp(0.9em, 2vw, 1.1em);
            color: #ef4444;
        }

        @media (max-width: 768px) {
            .players-grid {
                grid-template-columns: 1fr;
            }

            .game-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>⚔️ Math Duel 🔥</h1>
        <div class="subtitle">Battle your friend in an epic math showdown!</div>

        <div class="setup-panel" id="setupPanel">
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('easy')">😊 Easy</button>
                <button class="difficulty-btn" onclick="setDifficulty('medium')">😎 Medium</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')">🔥 Hard</button>
                <button class="difficulty-btn" onclick="setDifficulty('insane')">💀 Insane</button>
            </div>

            <div class="rounds-selector">
                <label>Rounds:</label>
                <select id="roundsSelect">
                    <option value="5">5 Rounds</option>
                    <option value="10" selected>10 Rounds</option>
                    <option value="15">15 Rounds</option>
                    <option value="20">20 Rounds</option>
                </select>
            </div>
        </div>

        <div class="round-indicator" id="roundIndicator">Press Start to Begin!</div>

        <div class="timer-bar-container" id="timerContainer" style="display: none;">
            <div class="timer-bar" id="timerBar"></div>
        </div>

        <div class="players-grid" id="playersGrid">
            <div class="player-panel player1-panel">
                <div class="player-header">🔵 Player 1</div>
                <div class="score-display">
                    <div class="score-label">Score</div>
                    <div class="score-value" id="score1">0</div>
                </div>
                <div class="streak-indicator" id="streak1" style="display: none;">🔥 Streak: 0</div>
                <div class="question-display">
                    <div class="question-text" id="question1">Ready?</div>
                </div>
                <input type="number" class="answer-input" id="answer1" placeholder="Your answer..." disabled>
                <button class="submit-answer-btn player1-submit" id="submit1" onclick="checkAnswer(1)" disabled>
                    Submit Answer (Enter)
                </button>
            </div>

            <div class="player-panel player2-panel">
                <div class="player-header">🔴 Player 2</div>
                <div class="score-display">
                    <div class="score-label">Score</div>
                    <div class="score-value" id="score2">0</div>
                </div>
                <div class="streak-indicator" id="streak2" style="display: none;">🔥 Streak: 0</div>
                <div class="question-display">
                    <div class="question-text" id="question2">Ready?</div>
                </div>
                <input type="number" class="answer-input" id="answer2" placeholder="Your answer..." disabled>
                <button class="submit-answer-btn player2-submit" id="submit2" onclick="checkAnswer(2)" disabled>
                    Submit Answer (Enter)
                </button>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="startBtn" onclick="startGame()">🎮 Start Duel</button>
            <button class="control-btn" onclick="pauseGame()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">⏸️ Pause</button>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="winner-banner" id="winnerBanner">
        <h2 id="winnerTitle"></h2>
        <div class="winner-stats" id="winnerStats"></div>
        <button class="control-btn" onclick="restartGame()" style="width: 250px; margin: 20px auto;">🔄 Play Again</button>
    </div>

    <script>
        let gameState = {
            running: false,
            paused: false,
            difficulty: 'medium',
            totalRounds: 10,
            currentRound: 0,
            timeLimit: 15,
            timeRemaining: 15,
            timerInterval: null,
            player1: {
                score: 0,
                streak: 0,
                maxStreak: 0,
                correct: 0,
                question: null,
                answer: null
            },
            player2: {
                score: 0,
                streak: 0,
                maxStreak: 0,
                correct: 0,
                question: null,
                answer: null
            }
        };

        const difficultySettings = {
            easy: { 
                timeLimit: 20,
                range: { min: 1, max: 20 },
                operations: ['+', '-']
            },
            medium: { 
                timeLimit: 15,
                range: { min: 5, max: 50 },
                operations: ['+', '-', '×']
            },
            hard: { 
                timeLimit: 12,
                range: { min: 10, max: 100 },
                operations: ['+', '-', '×', '÷']
            },
            insane: { 
                timeLimit: 8,
                range: { min: 20, max: 200 },
                operations: ['+', '-', '×', '÷']
            }
        };

        function setDifficulty(diff) {
            if (gameState.running) return;
            
            gameState.difficulty = diff;
            const settings = difficultySettings[diff];
            gameState.timeLimit = settings.timeLimit;
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function generateQuestion() {
            const settings = difficultySettings[gameState.difficulty];
            const operation = settings.operations[Math.floor(Math.random() * settings.operations.length)];
            
            let num1 = Math.floor(Math.random() * (settings.range.max - settings.range.min + 1)) + settings.range.min;
            let num2 = Math.floor(Math.random() * (settings.range.max - settings.range.min + 1)) + settings.range.min;
            let question, answer;

            if (operation === '+') {
                question = `${num1} + ${num2}`;
                answer = num1 + num2;
            } else if (operation === '-') {
                // Ensure no negative answers
                if (num1 < num2) [num1, num2] = [num2, num1];
                question = `${num1} - ${num2}`;
                answer = num1 - num2;
            } else if (operation === '×') {
                num1 = Math.floor(Math.random() * 20) + 2;
                num2 = Math.floor(Math.random() * 20) + 2;
                question = `${num1} × ${num2}`;
                answer = num1 * num2;
            } else if (operation === '÷') {
                // Ensure clean division
                num2 = Math.floor(Math.random() * 12) + 2;
                answer = Math.floor(Math.random() * 20) + 2;
                num1 = num2 * answer;
                question = `${num1} ÷ ${num2}`;
            }

            return { question, answer };
        }

        function showCountdown() {
            return new Promise(resolve => {
                const overlay = document.getElementById('overlay');
                overlay.classList.add('show');
                
                let count = 3;
                const showNumber = () => {
                    const countdown = document.createElement('div');
                    countdown.className = 'countdown';
                    countdown.textContent = count === 0 ? 'GO!' : count;
                    document.body.appendChild(countdown);
                    
                    setTimeout(() => {
                        countdown.remove();
                        if (count === 0) {
                            overlay.classList.remove('show');
                            resolve();
                        } else {
                            count--;
                            showNumber();
                        }
                    }, 1000);
                };
                
                showNumber();
            });
        }

        async function startGame() {
            gameState.totalRounds = parseInt(document.getElementById('roundsSelect').value);
            
            gameState.running = true;
            gameState.paused = false;
            gameState.currentRound = 0;
            gameState.player1 = { score: 0, streak: 0, maxStreak: 0, correct: 0, question: null, answer: null };
            gameState.player2 = { score: 0, streak: 0, maxStreak: 0, correct: 0, question: null, answer: null };
            
            document.getElementById('setupPanel').style.opacity = '0.5';
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.disabled = true);
            document.getElementById('roundsSelect').disabled = true;
            document.getElementById('startBtn').textContent = '🔄 Restart';
            
            updateDisplay();
            
            await showCountdown();
            
            nextRound();
        }

        function nextRound() {
            if (gameState.currentRound >= gameState.totalRounds) {
                endGame();
                return;
            }

            gameState.currentRound++;
            
            // Generate unique questions for each player
            const q1 = generateQuestion();
            const q2 = generateQuestion();
            
            gameState.player1.question = q1.question;
            gameState.player1.answer = q1.answer;
            gameState.player2.question = q2.question;
            gameState.player2.answer = q2.answer;
            
            document.getElementById('question1').textContent = q1.question + ' = ?';
            document.getElementById('question2').textContent = q2.question + ' = ?';
            
            const input1 = document.getElementById('answer1');
            const input2 = document.getElementById('answer2');
            
            input1.value = '';
            input2.value = '';
            input1.disabled = false;
            input2.disabled = false;
            input1.classList.remove('correct', 'incorrect');
            input2.classList.remove('correct', 'incorrect');
            
            document.getElementById('submit1').disabled = false;
            document.getElementById('submit2').disabled = false;
            input2.classList.remove('correct', 'incorrect');
            
            updateDisplay();
            startTimer();
            
            input1.focus();
        }

        function startTimer() {
            gameState.timeRemaining = gameState.timeLimit;
            document.getElementById('timerContainer').style.display = 'block';
            updateTimerBar();
            
            gameState.timerInterval = setInterval(() => {
                if (gameState.paused) return;
                
                gameState.timeRemaining--;
                updateTimerBar();
                
                if (gameState.timeRemaining <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerBar() {
            const percent = (gameState.timeRemaining / gameState.timeLimit) * 100;
            document.getElementById('timerBar').style.width = percent + '%';
        }

        function timeUp() {
            clearInterval(gameState.timerInterval);
            
            // Both players lose their streaks
            gameState.player1.streak = 0;
            gameState.player2.streak = 0;
            
            updateDisplay();
            
            setTimeout(nextRound, 2000);
        }

        // Player 1 answer checking
        document.getElementById('answer1').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !gameState.paused) {
                checkAnswer(1);
            }
        });

        // Player 2 answer checking
        document.getElementById('answer2').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !gameState.paused) {
                checkAnswer(2);
            }
        });

        function checkAnswer(playerNum) {
            const player = playerNum === 1 ? gameState.player1 : gameState.player2;
            const input = document.getElementById(`answer${playerNum}`);
            const submitBtn = document.getElementById(`submit${playerNum}`);
            const userAnswer = parseInt(input.value);
            
            if (isNaN(userAnswer)) return;
            
            input.disabled = true;
            submitBtn.disabled = true;
            
            if (userAnswer === player.answer) {
                input.classList.add('correct');
                
                const timeBonus = Math.floor(gameState.timeRemaining * 5);
                const streakBonus = player.streak * 10;
                const points = 100 + timeBonus + streakBonus;
                
                player.score += points;
                player.correct++;
                player.streak++;
                
                if (player.streak > player.maxStreak) {
                    player.maxStreak = player.streak;
                }
                
                updateDisplay();
                
                // Check if both answered
                if (document.getElementById('answer1').disabled && document.getElementById('answer2').disabled) {
                    clearInterval(gameState.timerInterval);
                    setTimeout(nextRound, 1500);
                }
            } else {
                input.classList.add('incorrect');
                player.streak = 0;
                updateDisplay();
            }
        }

        function updateDisplay() {
            document.getElementById('score1').textContent = gameState.player1.score;
            document.getElementById('score2').textContent = gameState.player2.score;
            
            document.getElementById('roundIndicator').textContent = 
                `Round ${gameState.currentRound}/${gameState.totalRounds}`;
            
            // Update streaks
            const streak1 = document.getElementById('streak1');
            const streak2 = document.getElementById('streak2');
            
            if (gameState.player1.streak > 0) {
                streak1.style.display = 'block';
                streak1.textContent = `🔥 Streak: ${gameState.player1.streak}`;
            } else {
                streak1.style.display = 'none';
            }
            
            if (gameState.player2.streak > 0) {
                streak2.style.display = 'block';
                streak2.textContent = `🔥 Streak: ${gameState.player2.streak}`;
            } else {
                streak2.style.display = 'none';
            }
        }

        function pauseGame() {
            if (!gameState.running) return;
            gameState.paused = !gameState.paused;
            
            if (gameState.paused) {
                clearInterval(gameState.timerInterval);
                document.getElementById('roundIndicator').textContent = '⏸️ PAUSED';
            } else {
                startTimer();
                updateDisplay();
            }
        }

        function endGame() {
            gameState.running = false;
            clearInterval(gameState.timerInterval);
            
            document.getElementById('answer1').disabled = true;
            document.getElementById('answer2').disabled = true;
            document.getElementById('submit1').disabled = true;
            document.getElementById('submit2').disabled = true;
            document.getElementById('timerContainer').style.display = 'none';
            
            const p1 = gameState.player1;
            const p2 = gameState.player2;
            
            let winnerTitle, winnerStats;
            
            if (p1.score > p2.score) {
                winnerTitle = '🔵 Player 1 Wins! 🏆';
            } else if (p2.score > p1.score) {
                winnerTitle = '🔴 Player 2 Wins! 🏆';
            } else {
                winnerTitle = '🤝 It\'s a Tie! 🤝';
            }
            
            winnerStats = `
                <strong>Final Scores:</strong><br>
                Player 1: ${p1.score} points (${p1.correct} correct, max streak: ${p1.maxStreak}🔥)<br>
                Player 2: ${p2.score} points (${p2.correct} correct, max streak: ${p2.maxStreak}🔥)<br>
                <br>
                <strong>Difficulty:</strong> ${gameState.difficulty.toUpperCase()}<br>
                <strong>Total Rounds:</strong> ${gameState.totalRounds}
            `;
            
            document.getElementById('winnerTitle').textContent = winnerTitle;
            document.getElementById('winnerStats').innerHTML = winnerStats;
            document.getElementById('overlay').classList.add('show');
            document.getElementById('winnerBanner').classList.add('show');
        }

        function restartGame() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('winnerBanner').classList.remove('show');
            
            document.getElementById('setupPanel').style.opacity = '1';
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.disabled = false);
            document.getElementById('roundsSelect').disabled = false;
            
            document.getElementById('question1').textContent = 'Ready?';
            document.getElementById('question2').textContent = 'Ready?';
            document.getElementById('answer1').value = '';
            document.getElementById('answer2').value = '';
            document.getElementById('roundIndicator').textContent = 'Press Start to Begin!';
            
            updateDisplay();
        }

        // Initialize
        updateDisplay();
    </script>
</body>
</html>